/*
 Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/

 Copyright 2012, Tim Down
 Licensed under the MIT license.
 Version: 1.2.3
 Build date: 26 February 2012
*/
window.rangy=function(){function a(d,a){var c=typeof d[a];return"function"==c||!("object"!=c||!d[a])||"unknown"==c}function n(d,a){return!("object"!=typeof d[a]||!d[a])}function x(d,a){return"undefined"!=typeof d[a]}function s(d){return function(a,c){for(var b=c.length;b--;)if(!d(a,c[b]))return!1;return!0}}function r(d){return d&&p(d,f)&&k(d,b)}function g(a){window.alert("Rangy not supported in your browser. Reason: "+a);d.initialized=!0;d.supported=!1}function h(){if(!d.initialized){var b,f=!1,h=
!1;a(document,"createRange")&&(b=document.createRange(),p(b,c)&&k(b,C)&&(f=!0),b.detach());(b=n(document,"body")?document.body:document.getElementsByTagName("body")[0])&&a(b,"createTextRange")&&(b=b.createTextRange(),r(b)&&(h=!0));f||h||g("Neither Range nor TextRange are implemented");d.initialized=!0;d.features={implementsDomRange:f,implementsTextRange:h};f=F.concat(q);h=0;for(b=f.length;h<b;++h)try{f[h](d)}catch(v){n(window,"console")&&a(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",
v)}}}function l(d){this.name=d;this.supported=this.initialized=!1}var C="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer START_TO_START START_TO_END END_TO_START END_TO_END".split(" "),c="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),b="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),
f="collapse compareEndPoints duplicate getBookmark moveToBookmark moveToElementText parentElement pasteHTML select setEndPoint getBoundingClientRect".split(" "),p=s(a),v=s(n),k=s(x),d={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:a,isHostObject:n,isHostProperty:x,areHostMethods:p,areHostObjects:v,areHostProperties:k,isTextRange:r},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};d.fail=g;d.warn=function(a){a="Rangy warning: "+a;d.config.alertOnWarn?window.alert(a):
"undefined"!=typeof window.console&&"undefined"!=typeof window.console.log&&window.console.log(a)};({}).hasOwnProperty?d.util.extend=function(d,a){for(var c in a)a.hasOwnProperty(c)&&(d[c]=a[c])}:g("hasOwnProperty not supported");var q=[],F=[];d.init=h;d.addInitListener=function(a){d.initialized?a(d):q.push(a)};var E=[];d.addCreateMissingNativeApiListener=function(d){E.push(d)};d.createMissingNativeApi=function(d){d=d||window;h();for(var a=0,c=E.length;a<c;++a)E[a](d)};l.prototype.fail=function(d){this.initialized=
!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+d);};l.prototype.warn=function(a){d.warn("Module "+this.name+": "+a)};l.prototype.createError=function(d){return Error("Error in Rangy "+this.name+" module: "+d)};d.createModule=function(a,c){var b=new l(a);d.modules[a]=b;F.push(function(d){c(d,b);b.initialized=!0;b.supported=!0})};d.requireModules=function(a){for(var c=0,b=a.length,q,f;c<b;++c){f=a[c];q=d.modules[f];if(!(q&&q instanceof l))throw Error("Module '"+f+"' not found");
if(!q.supported)throw Error("Module '"+f+"' not supported");}};var A=!1,v=function(a){A||(A=!0,d.initialized||h())};if("undefined"==typeof window)g("No window found");else if("undefined"==typeof document)g("No document found");else return a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",v,!1),a(window,"addEventListener")?window.addEventListener("load",v,!1):a(window,"attachEvent")?window.attachEvent("onload",v):g("Window does not have required addEventListener or attachEvent method"),
d}();
rangy.createModule("DomUtil",function(a,n){function x(d){for(var a=0;d=d.previousSibling;)a++;return a}function s(d,a){var c=[],b;for(b=d;b;b=b.parentNode)c.push(b);for(b=a;b;b=b.parentNode)if(k(c,b))return b;return null}function r(d,a,c){for(c=c?d:d.parentNode;c;){d=c.parentNode;if(d===a)return c;c=d}return null}function g(d){d=d.nodeType;return 3==d||4==d||8==d}function h(d,a){var c=a.nextSibling,b=a.parentNode;c?b.insertBefore(d,c):b.appendChild(d);return d}function l(d){if(9==d.nodeType)return d;if("undefined"!=
typeof d.ownerDocument)return d.ownerDocument;if("undefined"!=typeof d.document)return d.document;if(d.parentNode)return l(d.parentNode);throw Error("getDocument: no document found for node");}function C(d){return d?g(d)?'"'+d.data+'"':1==d.nodeType?"<"+d.nodeName+(d.id?' id="'+d.id+'"':"")+">["+d.childNodes.length+"]":d.nodeName:"[No node]"}function c(d){this._next=this.root=d}function b(d,a){this.node=d;this.offset=a}function f(d){this.code=this[d];this.codeName=d;this.message="DOMException: "+
this.codeName}var p=a.util;p.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||n.fail("document missing a Node creation method");p.isHostMethod(document,"getElementsByTagName")||n.fail("document missing getElementsByTagName method");var v=document.createElement("div");p.areHostMethods(v,["insertBefore","appendChild","cloneNode"])||n.fail("Incomplete Element implementation");p.isHostProperty(v,"innerHTML")||n.fail("Element is missing innerHTML property");v=document.createTextNode("test");
p.areHostMethods(v,["splitText","deleteData","insertData","appendData","cloneNode"])||n.fail("Incomplete Text Node implementation");var k=function(d,a){for(var c=d.length;c--;)if(d[c]===a)return!0;return!1};c.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var d=this._current=this._next,a;if(this._current){a=d.firstChild;if(!a)for(a=null;d!==this.root&&!(a=d.nextSibling);)d=d.parentNode;this._next=a}return this._current},detach:function(){this._current=this._next=this.root=
null}};b.prototype={equals:function(d){return this.node===d.node&this.offset==d.offset},inspect:function(){return"[DomPosition("+C(this.node)+":"+this.offset+")]"}};f.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};f.prototype.toString=function(){return this.message};a.dom={arrayContains:k,isHtmlNamespace:function(d){var a;return"undefined"==typeof d.namespaceURI||null===(a=d.namespaceURI)||
"http://www.w3.org/1999/xhtml"==a},parentElement:function(a){a=a.parentNode;return 1==a.nodeType?a:null},getNodeIndex:x,getNodeLength:function(a){var c;return g(a)?a.length:(c=a.childNodes)?c.length:0},getCommonAncestor:s,isAncestorOf:function(a,c,b){for(c=b?c:c.parentNode;c;){if(c===a)return!0;c=c.parentNode}return!1},getClosestAncestorIn:r,isCharacterDataNode:g,insertAfter:h,splitDataNode:function(a,c){var b=a.cloneNode(!1);b.deleteData(0,c);a.deleteData(c,a.length-c);h(b,a);return b},getDocument:l,
getWindow:function(a){a=l(a);if("undefined"!=typeof a.defaultView)return a.defaultView;if("undefined"!=typeof a.parentWindow)return a.parentWindow;throw Error("Cannot get a window object for node");},getIframeWindow:function(a){if("undefined"!=typeof a.contentWindow)return a.contentWindow;if("undefined"!=typeof a.contentDocument)return a.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(a){if("undefined"!=typeof a.contentDocument)return a.contentDocument;
if("undefined"!=typeof a.contentWindow)return a.contentWindow.document;throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(a){return p.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]},getRootContainer:function(a){for(var c;c=a.parentNode;)a=c;return a},comparePoints:function(a,c,b,f){var g;if(a==b)return c===f?0:c<f?-1:1;if(g=r(b,a,!0))return c<=x(g)?-1:1;if(g=r(a,b,!0))return x(g)<f?-1:1;c=s(a,b);a=a===c?c:r(a,c,!0);b=b===c?c:r(b,c,!0);if(a===
b)throw Error("comparePoints got to case 4 and childA and childB are the same!");for(c=c.firstChild;c;){if(c===a)return-1;if(c===b)return 1;c=c.nextSibling}throw Error("Should not be here!");},inspectNode:C,fragmentFromNodeChildren:function(a){for(var c=l(a).createDocumentFragment(),b;b=a.firstChild;)c.appendChild(b);return c},createIterator:function(a){return new c(a)},DomPosition:b};a.DOMException=f});
rangy.createModule("DomRange",function(a,n){function x(t,a){return 3!=t.nodeType&&(m.isAncestorOf(t,a.startContainer,!0)||m.isAncestorOf(t,a.endContainer,!0))}function s(t){return m.getDocument(t.startContainer)}function r(t,a,c){if(a=t._listeners[a])for(var e=0,b=a.length;e<b;++e)a[e].call(t,{target:t,args:c})}function g(a){return new Q(a.parentNode,m.getNodeIndex(a))}function h(a){return new Q(a.parentNode,m.getNodeIndex(a)+1)}function l(a,e,c){var b=11==a.nodeType?a.firstChild:a;m.isCharacterDataNode(e)?
c==e.length?m.insertAfter(a,e):e.parentNode.insertBefore(a,0==c?e:m.splitDataNode(e,c)):c>=e.childNodes.length?e.appendChild(a):e.insertBefore(a,e.childNodes[c]);return b}function C(a){for(var e,c,b=s(a.range).createDocumentFragment();c=a.next();){e=a.isPartiallySelectedSubtree();c=c.cloneNode(!e);e&&(e=a.getSubtreeIterator(),c.appendChild(C(e)),e.detach(!0));if(10==c.nodeType)throw new B("HIERARCHY_REQUEST_ERR");b.appendChild(c)}return b}function c(a,e,b){var d,y;for(b=b||{stop:!1};d=a.next();)if(a.isPartiallySelectedSubtree())if(!1===
e(d)){b.stop=!0;break}else{if(d=a.getSubtreeIterator(),c(d,e,b),d.detach(!0),b.stop)break}else for(d=m.createIterator(d);y=d.next();)if(!1===e(y)){b.stop=!0;return}}function b(a){for(var e;a.next();)a.isPartiallySelectedSubtree()?(e=a.getSubtreeIterator(),b(e),e.detach(!0)):a.remove()}function f(a){for(var e,c=s(a.range).createDocumentFragment(),b;e=a.next();){a.isPartiallySelectedSubtree()?(e=e.cloneNode(!1),b=a.getSubtreeIterator(),e.appendChild(f(b)),b.detach(!0)):a.remove();if(10==e.nodeType)throw new B("HIERARCHY_REQUEST_ERR");
c.appendChild(e)}return c}function p(a,e,b){var d=!(!e||!e.length),y,f=!!b;d&&(y=new RegExp("^("+e.join("|")+")$"));var g=[];c(new k(a,!1),function(a){d&&!y.test(a.nodeType)||f&&!b(a)||g.push(a)});return g}function v(a){return"["+("undefined"==typeof a.getName?"Range":a.getName())+"("+m.inspectNode(a.startContainer)+":"+a.startOffset+", "+m.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function k(a,e){this.range=a;this.clonePartiallySelectedTextNodes=e;if(!a.collapsed){this.sc=a.startContainer;
this.so=a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&m.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||m.isCharacterDataNode(this.sc)?m.getClosestAncestorIn(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||m.isCharacterDataNode(this.ec)?m.getClosestAncestorIn(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function d(a){this.code=
this[a];this.codeName=a;this.message="RangeException: "+this.codeName}function q(a,e,c){this.nodes=p(a,e,c);this._next=this.nodes[0];this._position=0}function F(a){return function(e,c){for(var b,d=c?e:e.parentNode;d;){b=d.nodeType;if(m.arrayContains(a,b))return d;d=d.parentNode}return null}}function E(a,e){if($(a,e))throw new d("INVALID_NODE_TYPE_ERR");}function A(a){if(!a.startContainer)throw new B("INVALID_STATE_ERR");}function J(a,e){if(!m.arrayContains(e,a.nodeType))throw new d("INVALID_NODE_TYPE_ERR");
}function I(a,e){if(0>e||e>(m.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new B("INDEX_SIZE_ERR");}function K(a,e){if(W(a,!0)!==W(e,!0))throw new B("WRONG_DOCUMENT_ERR");}function z(a){if(aa(a,!0))throw new B("NO_MODIFICATION_ALLOWED_ERR");}function H(a,e){if(!a)throw new B(e);}function L(a){return!m.arrayContains(y,a.nodeType)&&!W(a,!0)}function R(a,e){return e<=(m.isCharacterDataNode(a)?a.length:a.childNodes.length)}function M(a){return!!a.startContainer&&!!a.endContainer&&!L(a.startContainer)&&
!L(a.endContainer)&&R(a.startContainer,a.startOffset)&&R(a.endContainer,a.endOffset)}function w(a){A(a);if(!M(a))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")");}function N(){}function S(a){a.START_TO_START=0;a.START_TO_END=1;a.END_TO_END=2;a.END_TO_START=3;a.NODE_BEFORE=0;a.NODE_AFTER=1;a.NODE_BEFORE_AND_AFTER=2;a.NODE_INSIDE=3}function P(a){S(a);S(a.prototype)}function T(a,e){return function(){w(this);var b=this.startContainer,d=this.startOffset,y=this.commonAncestorContainer,
f=new k(this,!0);b!==y&&(b=m.getClosestAncestorIn(b,y,!0),d=h(b),b=d.node,d=d.offset);c(f,z);f.reset();y=a(f);f.detach();e(this,b,d,b,d);return y}}function G(c,d,p){function q(a,c){return function(b){A(this);J(b,e);J(U(b),y);b=(a?g:h)(b);(c?V:v)(this,b.node,b.offset)}}function V(a,e,c){var b=a.endContainer,t=a.endOffset;if(e!==a.startContainer||c!==a.startOffset){if(U(e)!=U(b)||1==m.comparePoints(e,c,b,t))b=e,t=c;d(a,e,c,b,t)}}function v(a,e,c){var b=a.startContainer,t=a.startOffset;if(e!==a.endContainer||
c!==a.endOffset){if(U(e)!=U(b)||-1==m.comparePoints(e,c,b,t))b=e,t=c;d(a,b,t,e,c)}}c.prototype=new N;a.util.extend(c.prototype,{setStart:function(a,e){A(this);E(a,!0);I(a,e);V(this,a,e)},setEnd:function(a,e){A(this);E(a,!0);I(a,e);v(this,a,e)},setStartBefore:q(!0,!0),setStartAfter:q(!1,!0),setEndBefore:q(!0,!1),setEndAfter:q(!1,!1),collapse:function(a){w(this);a?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,
this.endOffset)},selectNodeContents:function(a){A(this);E(a,!0);d(this,a,0,a,m.getNodeLength(a))},selectNode:function(a){A(this);E(a,!1);J(a,e);var c=g(a);a=h(a);d(this,c.node,c.offset,a.node,a.offset)},extractContents:T(f,d),deleteContents:T(b,d),canSurroundContents:function(){w(this);z(this.startContainer);z(this.endContainer);var a=new k(this,!0),e=a._first&&x(a._first,this)||a._last&&x(a._last,this);a.detach();return!e},detach:function(){p(this)},splitBoundaries:function(){w(this);var a=this.startContainer,
e=this.startOffset,c=this.endContainer,b=this.endOffset,t=a===c;m.isCharacterDataNode(c)&&0<b&&b<c.length&&m.splitDataNode(c,b);m.isCharacterDataNode(a)&&0<e&&e<a.length&&(a=m.splitDataNode(a,e),t?(b-=e,c=a):c==a.parentNode&&b>=m.getNodeIndex(a)&&b++,e=0);d(this,a,e,c,b)},normalizeBoundaries:function(){w(this);var a=this.startContainer,e=this.startOffset,c=this.endContainer,b=this.endOffset,t=function(a){var e=a.nextSibling;e&&e.nodeType==a.nodeType&&(c=a,b=a.length,a.appendData(e.data),e.parentNode.removeChild(e))},
y=function(d){var t=d.previousSibling;if(t&&t.nodeType==d.nodeType){a=d;var y=d.length;e=t.length;d.insertData(0,t.data);t.parentNode.removeChild(t);a==c?(b+=e,c=a):c==d.parentNode&&(t=m.getNodeIndex(d),b==t?(c=d,b=y):b>t&&b--)}},f=!0;m.isCharacterDataNode(c)?c.length==b&&t(c):(0<b&&(f=c.childNodes[b-1])&&m.isCharacterDataNode(f)&&t(f),f=!this.collapsed);f?m.isCharacterDataNode(a)?0==e&&y(a):e<a.childNodes.length&&(t=a.childNodes[e])&&m.isCharacterDataNode(t)&&y(t):(a=c,e=b);d(this,a,e,c,b)},collapseToPoint:function(a,
e){A(this);E(a,!0);I(a,e);a===this.startContainer&&e===this.startOffset&&a===this.endContainer&&e===this.endOffset||d(this,a,e,a,e)}});P(c)}function u(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:m.getCommonAncestor(a.startContainer,a.endContainer)}function O(a,e,c,b,d){var y=a.startContainer!==e||a.startOffset!==c,f=a.endContainer!==b||a.endOffset!==d;a.startContainer=e;a.startOffset=c;a.endContainer=b;a.endOffset=
d;u(a);r(a,"boundarychange",{startMoved:y,endMoved:f})}function D(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};u(this)}a.requireModules(["DomUtil"]);var m=a.dom,Q=m.DomPosition,B=a.DOMException;k.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=
this._next;a&&(this._next=a!==this._last?a.nextSibling:null,m.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so)));return a},remove:function(){var a=this._current,e,c;!m.isCharacterDataNode(a)||a!==this.sc&&a!==this.ec?a.parentNode&&a.parentNode.removeChild(a):(e=a===this.sc?this.so:0,c=a===this.ec?this.eo:a.length,e!=c&&a.deleteData(e,c-e))},isPartiallySelectedSubtree:function(){return x(this._current,
this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new D(s(this.range));var e=this._current,c=e,b=0,d=e,y=m.getNodeLength(e);m.isAncestorOf(e,this.sc,!0)&&(c=this.sc,b=this.so);m.isAncestorOf(e,this.ec,!0)&&(d=this.ec,y=this.eo);O(a,c,b,d,y)}return new k(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=
null}};d.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};d.prototype.toString=function(){return this.message};q.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var e=[1,3,4,5,7,8,10],y=[2,9,11],V=[1,3,4,5,7,8,10,11],ba=[1,3,4,5,7,8],U=m.getRootContainer,W=F([9,11]),aa=F([5,6,10,12]),$=F([6,10,12]),Z=document.createElement("style"),
X=!1;try{Z.innerHTML="<b>x</b>",X=3==Z.firstChild.nodeType}catch(ca){}a.features.htmlParsingConforms=X;var Y="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" ");N.prototype={attachListener:function(a,e){this._listeners[a].push(e)},compareBoundaryPoints:function(a,e){w(this);K(this.startContainer,e.startContainer);var c=3==a||0==a?"start":"end",b=1==a||0==a?"start":"end";return m.comparePoints(this[c+"Container"],this[c+"Offset"],e[b+"Container"],e[b+"Offset"])},
insertNode:function(a){w(this);J(a,V);z(this.startContainer);if(m.isAncestorOf(a,this.startContainer,!0))throw new B("HIERARCHY_REQUEST_ERR");a=l(a,this.startContainer,this.startOffset);this.setStartBefore(a)},cloneContents:function(){w(this);var a,e;if(this.collapsed)return s(this).createDocumentFragment();if(this.startContainer===this.endContainer&&m.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),e=s(this).createDocumentFragment(),
e.appendChild(a),e;e=new k(this,!0);a=C(e);e.detach();return a},canSurroundContents:function(){w(this);z(this.startContainer);z(this.endContainer);var a=new k(this,!0),e=a._first&&x(a._first,this)||a._last&&x(a._last,this);a.detach();return!e},surroundContents:function(a){J(a,ba);if(!this.canSurroundContents())throw new d("BAD_BOUNDARYPOINTS_ERR");var e=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);l(a,this.startContainer,this.startOffset);a.appendChild(e);
this.selectNode(a)},cloneRange:function(){w(this);for(var a=new D(s(this)),e=Y.length,c;e--;)c=Y[e],a[c]=this[c];return a},toString:function(){w(this);var a=this.startContainer;if(a===this.endContainer&&m.isCharacterDataNode(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var e=[],a=new k(this,!0);c(a,function(a){3!=a.nodeType&&4!=a.nodeType||e.push(a.data)});a.detach();return e.join("")},compareNode:function(a){w(this);var e=a.parentNode,c=m.getNodeIndex(a);
if(!e)throw new B("NOT_FOUND_ERR");a=this.comparePoint(e,c);e=this.comparePoint(e,c+1);return 0>a?0<e?2:0:0<e?1:3},comparePoint:function(a,e){w(this);H(a,"HIERARCHY_REQUEST_ERR");K(a,this.startContainer);return 0>m.comparePoints(a,e,this.startContainer,this.startOffset)?-1:0<m.comparePoints(a,e,this.endContainer,this.endOffset)?1:0},createContextualFragment:X?function(a){var e=this.startContainer,c=m.getDocument(e);if(!e)throw new B("INVALID_STATE_ERR");var b=null;1==e.nodeType?b=e:m.isCharacterDataNode(e)&&
(b=m.parentElement(e));b=null===b||"HTML"==b.nodeName&&m.isHtmlNamespace(m.getDocument(b).documentElement)&&m.isHtmlNamespace(b)?c.createElement("body"):b.cloneNode(!1);b.innerHTML=a;return m.fragmentFromNodeChildren(b)}:function(a){A(this);var e=s(this).createElement("body");e.innerHTML=a;return m.fragmentFromNodeChildren(e)},toHtml:function(){w(this);var a=s(this).createElement("div");a.appendChild(this.cloneContents());return a.innerHTML},intersectsNode:function(a,e){w(this);H(a,"NOT_FOUND_ERR");
if(m.getDocument(a)!==s(this))return!1;var c=a.parentNode,b=m.getNodeIndex(a);H(c,"NOT_FOUND_ERR");var d=m.comparePoints(c,b,this.endContainer,this.endOffset),c=m.comparePoints(c,b+1,this.startContainer,this.startOffset);return e?0>=d&&0<=c:0>d&&0<c},isPointInRange:function(a,e){w(this);H(a,"HIERARCHY_REQUEST_ERR");K(a,this.startContainer);return 0<=m.comparePoints(a,e,this.startContainer,this.startOffset)&&0>=m.comparePoints(a,e,this.endContainer,this.endOffset)},intersectsRange:function(a,e){w(this);
if(s(a)!=s(this))throw new B("WRONG_DOCUMENT_ERR");var c=m.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),b=m.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return e?0>=c&&0<=b:0>c&&0<b},intersection:function(a){if(this.intersectsRange(a)){var e=m.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=m.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),b=this.cloneRange();-1==e&&
b.setStart(a.startContainer,a.startOffset);1==c&&b.setEnd(a.endContainer,a.endOffset);return b}return null},union:function(a){if(this.intersectsRange(a,!0)){var e=this.cloneRange();-1==m.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&e.setStart(a.startContainer,a.startOffset);1==m.comparePoints(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&e.setEnd(a.endContainer,a.endOffset);return e}throw new d("Ranges do not intersect");},containsNode:function(a,
e){return e?this.intersectsNode(a,!1):3==this.compareNode(a)},containsNodeContents:function(a){return 0<=this.comparePoint(a,0)&&0>=this.comparePoint(a,m.getNodeLength(a))},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var e=this.cloneRange();e.selectNode(a);var c=e.getNodes([3]);return 0<c.length?(e.setStart(c[0],0),a=c.pop(),e.setEnd(a,a.length),a=this.containsRange(e),e.detach(),a):this.containsNodeContents(a)},createNodeIterator:function(a,e){w(this);
return new q(this,a,e)},getNodes:function(a,e){w(this);return p(this,a,e)},getDocument:function(){return s(this)},collapseBefore:function(a){A(this);this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){A(this);this.setStartAfter(a);this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return D.rangesEqual(this,a)},isValid:function(){return M(this)},inspect:function(){return v(this)}};G(D,O,function(a){A(a);a.startContainer=a.startOffset=a.endContainer=a.endOffset=
null;a.collapsed=a.commonAncestorContainer=null;r(a,"detach",null);a._listeners=null});a.rangePrototype=N.prototype;D.rangeProperties=Y;D.RangeIterator=k;D.copyComparisonConstants=P;D.createPrototypeRange=G;D.inspect=v;D.getRangeDocument=s;D.rangesEqual=function(a,e){return a.startContainer===e.startContainer&&a.startOffset===e.startOffset&&a.endContainer===e.endContainer&&a.endOffset===e.endOffset};a.DomRange=D;a.RangeException=d});
rangy.createModule("WrappedRange",function(a,n){function x(a,b,f,p){var v=a.duplicate();v.collapse(f);var k=v.parentElement();g.isAncestorOf(b,k,!0)||(k=b);if(!k.canHaveHTML)return new h(k.parentNode,g.getNodeIndex(k));b=g.getDocument(k).createElement("span");var d,q=f?"StartToStart":"StartToEnd";do k.insertBefore(b,b.previousSibling),v.moveToElementText(b);while(0<(d=v.compareEndPoints(q,a))&&b.previousSibling);q=b.nextSibling;if(-1==d&&q&&g.isCharacterDataNode(q)){v.setEndPoint(f?"EndToStart":"EndToEnd",
a);if(/[\r\n]/.test(q.data))for(k=v.duplicate(),f=k.text.replace(/\r\n/g,"\r").length,f=k.moveStart("character",f);-1==k.compareEndPoints("StartToEnd",k);)f++,k.moveStart("character",1);else f=v.text.length;k=new h(q,f)}else q=(p||!f)&&b.previousSibling,k=(f=(p||f)&&b.nextSibling)&&g.isCharacterDataNode(f)?new h(f,0):q&&g.isCharacterDataNode(q)?new h(q,q.length):new h(k,g.getNodeIndex(b));b.parentNode.removeChild(b);return k}function s(a,b){var f,p,h=a.offset,k=g.getDocument(a.node),d=k.body.createTextRange(),
q=g.isCharacterDataNode(a.node);q?(f=a.node,p=f.parentNode):(f=a.node.childNodes,f=h<f.length?f[h]:null,p=a.node);k=k.createElement("span");k.innerHTML="&#feff;";f?p.insertBefore(k,f):p.appendChild(k);d.moveToElementText(k);d.collapse(!b);p.removeChild(k);if(q)d[b?"moveStart":"moveEnd"]("character",h);return d}a.requireModules(["DomUtil","DomRange"]);var r,g=a.dom,h=g.DomPosition,l=a.DomRange;if(a.features.implementsDomRange&&(!a.features.implementsTextRange||!a.config.preferTextRange))(function(){function c(a){for(var c=
f.length,b;c--;)b=f[c],a[b]=a.nativeRange[b]}var b,f=l.rangeProperties,p;r=function(a){if(!a)throw Error("Range must be specified");this.nativeRange=a;c(this)};l.createPrototypeRange(r,function(a,c,b,d,f){var g=a.endContainer!==d||a.endOffset!=f;if(a.startContainer!==c||a.startOffset!=b||g)a.setEnd(d,f),a.setStart(c,b)},function(a){a.nativeRange.detach();a.detached=!0;for(var c=f.length,b;c--;)b=f[c],a[b]=null});b=r.prototype;b.selectNode=function(a){this.nativeRange.selectNode(a);c(this)};b.deleteContents=
function(){this.nativeRange.deleteContents();c(this)};b.extractContents=function(){var a=this.nativeRange.extractContents();c(this);return a};b.cloneContents=function(){return this.nativeRange.cloneContents()};b.surroundContents=function(a){this.nativeRange.surroundContents(a);c(this)};b.collapse=function(a){this.nativeRange.collapse(a);c(this)};b.cloneRange=function(){return new r(this.nativeRange.cloneRange())};b.refresh=function(){c(this)};b.toString=function(){return this.nativeRange.toString()};
var h=document.createTextNode("test");g.getBody(document).appendChild(h);var k=document.createRange();k.setStart(h,0);k.setEnd(h,0);try{k.setStart(h,1),b.setStart=function(a,b){this.nativeRange.setStart(a,b);c(this)},b.setEnd=function(a,b){this.nativeRange.setEnd(a,b);c(this)},p=function(a){return function(b){this.nativeRange[a](b);c(this)}}}catch(d){b.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(d){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}c(this)},b.setEnd=function(a,
b){try{this.nativeRange.setEnd(a,b)}catch(d){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}c(this)},p=function(a,b){return function(d){try{this.nativeRange[a](d)}catch(f){this.nativeRange[b](d),this.nativeRange[a](d)}c(this)}}}b.setStartBefore=p("setStartBefore","setEndBefore");b.setStartAfter=p("setStartAfter","setEndAfter");b.setEndBefore=p("setEndBefore","setStartBefore");b.setEndAfter=p("setEndAfter","setStartAfter");k.selectNodeContents(h);b.selectNodeContents=k.startContainer==
h&&k.endContainer==h&&0==k.startOffset&&k.endOffset==h.length?function(a){this.nativeRange.selectNodeContents(a);c(this)}:function(a){this.setStart(a,0);this.setEnd(a,l.getEndOffset(a))};k.selectNodeContents(h);k.setEnd(h,3);p=document.createRange();p.selectNodeContents(h);p.setEnd(h,4);p.setStart(h,2);-1==k.compareBoundaryPoints(k.START_TO_END,p)&1==k.compareBoundaryPoints(k.END_TO_START,p)?b.compareBoundaryPoints=function(a,c){c=c.nativeRange||c;a==c.START_TO_END?a=c.END_TO_START:a==c.END_TO_START&&
(a=c.START_TO_END);return this.nativeRange.compareBoundaryPoints(a,c)}:b.compareBoundaryPoints=function(a,c){return this.nativeRange.compareBoundaryPoints(a,c.nativeRange||c)};a.util.isHostMethod(k,"createContextualFragment")&&(b.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)});g.getBody(document).removeChild(h);k.detach();p.detach()})(),a.createNativeRange=function(a){a=a||document;return a.createRange()};else if(a.features.implementsTextRange){r=function(a){this.textRange=
a;this.refresh()};r.prototype=new l(document);r.prototype.refresh=function(){var a,b,f=this.textRange;a=f.parentElement();var h=f.duplicate();h.collapse(!0);b=h.parentElement();h=f.duplicate();h.collapse(!1);f=h.parentElement();b=b==f?b:g.getCommonAncestor(b,f);b=b==a?b:g.getCommonAncestor(a,b);a=this.textRange;0==a.compareEndPoints("StartToEnd",a)?b=a=x(this.textRange,b,!0,!0):(a=x(this.textRange,b,!0,!1),b=x(this.textRange,b,!1,!1));this.setStart(a.node,a.offset);this.setEnd(b.node,b.offset)};l.copyComparisonConstants(r);
var C=function(){return this}();"undefined"==typeof C.Range&&(C.Range=r);a.createNativeRange=function(a){a=a||document;return a.body.createTextRange()}}a.features.implementsTextRange&&(r.rangeToTextRange=function(a){if(a.collapsed)return s(new h(a.startContainer,a.startOffset),!0);var b=s(new h(a.startContainer,a.startOffset),!0),f=s(new h(a.endContainer,a.endOffset),!1);a=g.getDocument(a.startContainer).body.createTextRange();a.setEndPoint("StartToStart",b);a.setEndPoint("EndToEnd",f);return a});
r.prototype.getName=function(){return"WrappedRange"};a.WrappedRange=r;a.createRange=function(c){c=c||document;return new r(a.createNativeRange(c))};a.createRangyRange=function(a){a=a||document;return new l(a)};a.createIframeRange=function(c){return a.createRange(g.getIframeDocument(c))};a.createIframeRangyRange=function(c){return a.createRangyRange(g.getIframeDocument(c))};a.addCreateMissingNativeApiListener(function(c){c=c.document;"undefined"==typeof c.createRange&&(c.createRange=function(){return a.createRange(this)});
c=c=null})});
rangy.createModule("WrappedSelection",function(a,n){function x(a){return(a||window).getSelection()}function s(a){return(a||window).document.selection}function r(a,b,c){var d=c?"end":"start";c=c?"start":"end";a.anchorNode=b[d+"Container"];a.anchorOffset=b[d+"Offset"];a.focusNode=b[c+"Container"];a.focusOffset=b[c+"Offset"]}function g(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function h(e){var b;e instanceof F?(b=e._selectionNativeRange,
b||(b=a.createNativeRange(d.getDocument(e.startContainer)),b.setEnd(e.endContainer,e.endOffset),b.setStart(e.startContainer,e.startOffset),e._selectionNativeRange=b,e.attachListener("detach",function(){this._selectionNativeRange=null}))):e instanceof E?b=e.nativeRange:a.features.implementsDomRange&&e instanceof d.getWindow(e.startContainer).Range&&(b=e);return b}function l(a){var b=a.getNodes(),c;a:if(b.length&&1==b[0].nodeType){c=1;for(var f=b.length;c<f;++c)if(!d.isAncestorOf(b[0],b[c])){c=!1;break a}c=
!0}else c=!1;if(!c)throw Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function C(a,b){var c=new E(b);a._ranges=[c];r(a,c,!1);a.rangeCount=1;a.isCollapsed=c.collapsed}function c(e){e._ranges.length=0;if("None"==e.docSelection.type)g(e);else{var b=e.docSelection.createRange();if(b&&"undefined"!=typeof b.text)C(e,b);else{e.rangeCount=b.length;for(var c,f=d.getDocument(b.item(0)),h=0;h<e.rangeCount;++h)c=a.createRange(f),c.selectNode(b.item(h)),
e._ranges.push(c);e.isCollapsed=1==e.rangeCount&&e._ranges[0].collapsed;r(e,e._ranges[e.rangeCount-1],!1)}}}function b(a,b){for(var f=a.docSelection.createRange(),g=l(b),h=d.getDocument(f.item(0)),h=d.getBody(h).createControlRange(),k=0,p=f.length;k<p;++k)h.add(f.item(k));try{h.add(g)}catch(m){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}h.select();c(a)}function f(a,b,c){this.nativeSelection=a;this.docSelection=b;this._ranges=
[];this.win=c;this.refresh()}function p(a,b){for(var f=d.getDocument(b[0].startContainer),f=d.getBody(f).createControlRange(),g=0,h;g<rangeCount;++g){h=l(b[g]);try{f.add(h)}catch(k){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}f.select();c(a)}function v(a,b){if(a.anchorNode&&d.getDocument(a.anchorNode)!==d.getDocument(b))throw new A("WRONG_DOCUMENT_ERR");}function k(a){var b=[],c=new J(a.anchorNode,a.anchorOffset),
d=new J(a.focusNode,a.focusOffset),f="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var g=0,h=a.rangeCount;g<h;++g)b[g]=F.inspect(a.getRangeAt(g));return"["+f+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]);a.config.checkSelectionRanges=!0;var d=a.dom,q=a.util,F=a.DomRange,E=a.WrappedRange,A=a.DOMException,J=d.DomPosition,I,K,z=a.util.isHostMethod(window,"getSelection"),
H=a.util.isHostObject(document,"selection"),L=H&&(!z||a.config.preferTextRange);L?(I=s,a.isSelectionValid=function(a){a=(a||window).document;var b=a.selection;return"None"!=b.type||d.getDocument(b.createRange().parentElement())==a}):z?(I=x,a.isSelectionValid=function(){return!0}):n.fail("Neither document.selection or window.getSelection() detected.");a.getNativeSelection=I;var z=I(),R=a.createNativeRange(document),M=d.getBody(document),w=q.areHostObjects(z,q.areHostProperties(z,["anchorOffset","focusOffset"]));
a.features.selectionHasAnchorAndFocus=w;var N=q.isHostMethod(z,"extend");a.features.selectionHasExtend=N;var S="number"==typeof z.rangeCount;a.features.selectionHasRangeCount=S;var P=!1,T=!0;q.areHostMethods(z,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof z.rangeCount&&a.features.implementsDomRange&&function(){var a=document.createElement("iframe");a.frameBorder=0;a.style.position="absolute";a.style.left="-10000px";M.appendChild(a);var b=d.getIframeDocument(a);b.open();b.write("<html><head></head><body>12</body></html>");
b.close();var c=d.getIframeWindow(a).getSelection(),f=b.documentElement.lastChild.firstChild,b=b.createRange();b.setStart(f,1);b.collapse(!0);c.addRange(b);T=1==c.rangeCount;c.removeAllRanges();var g=b.cloneRange();b.setStart(f,0);g.setEnd(f,2);c.addRange(b);c.addRange(g);P=2==c.rangeCount;b.detach();g.detach();M.removeChild(a)}();a.features.selectionSupportsMultipleRanges=P;a.features.collapsedNonEditableSelectionsSupported=T;var G=!1,u;M&&q.isHostMethod(M,"createControlRange")&&(u=M.createControlRange(),
q.areHostProperties(u,["item","add"])&&(G=!0));a.features.implementsControlRange=G;K=w?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var O;q.isHostMethod(z,"getRangeAt")?O=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:w&&(O=function(b){var c=d.getDocument(b.anchorNode),c=a.createRange(c);c.setStart(b.anchorNode,b.anchorOffset);c.setEnd(b.focusNode,b.focusOffset);c.collapsed!==
this.isCollapsed&&(c.setStart(b.focusNode,b.focusOffset),c.setEnd(b.anchorNode,b.anchorOffset));return c});a.getSelection=function(a){a=a||window;var b=a._rangySelection,c=I(a),d=H?s(a):null;b?(b.nativeSelection=c,b.docSelection=d,b.refresh(a)):(b=new f(c,d,a),a._rangySelection=b);return b};a.getIframeSelection=function(b){return a.getSelection(d.getIframeWindow(b))};u=f.prototype;if(!L&&w&&q.areHostMethods(z,["removeAllRanges","addRange"])){u.removeAllRanges=function(){this.nativeSelection.removeAllRanges();
g(this)};var D=function(b,c){var d=F.getRangeDocument(c),d=a.createRange(d);d.collapseToPoint(c.endContainer,c.endOffset);b.nativeSelection.addRange(h(d));b.nativeSelection.extend(c.startContainer,c.startOffset);b.refresh()};u.addRange=S?function(c,d){if(G&&H&&"Control"==this.docSelection.type)b(this,c);else if(d&&N)D(this,c);else{var f;P?f=this.rangeCount:(this.removeAllRanges(),f=0);this.nativeSelection.addRange(h(c));this.rangeCount=this.nativeSelection.rangeCount;this.rangeCount==f+1?(a.config.checkSelectionRanges&&
(f=O(this.nativeSelection,this.rangeCount-1))&&!F.rangesEqual(f,c)&&(c=new E(f)),this._ranges[this.rangeCount-1]=c,r(this,c,B(this.nativeSelection)),this.isCollapsed=K(this)):this.refresh()}}:function(a,b){b&&N?D(this,a):(this.nativeSelection.addRange(h(a)),this.refresh())};u.setRanges=function(a){if(G&&1<a.length)p(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else if(q.isHostMethod(z,"empty")&&q.isHostMethod(R,"select")&&G&&L)u.removeAllRanges=function(){try{if(this.docSelection.empty(),
"None"!=this.docSelection.type){var a;if(this.anchorNode)a=d.getDocument(this.anchorNode);else if("Control"==this.docSelection.type){var b=this.docSelection.createRange();b.length&&(a=d.getDocument(b.item(0)).body.createTextRange())}a&&(a.body.createTextRange().select(),this.docSelection.empty())}}catch(c){}g(this)},u.addRange=function(a){"Control"==this.docSelection.type?b(this,a):(E.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,r(this,
a,!1))},u.setRanges=function(a){this.removeAllRanges();var b=a.length;1<b?p(this,a):b&&this.addRange(a[0])};else return n.fail("No means of selecting a Range or TextRange was found"),!1;u.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new A("INDEX_SIZE_ERR");return this._ranges[a]};var m;if(L)m=function(b){var f;a.isSelectionValid(b.win)?f=b.docSelection.createRange():(f=d.getBody(b.win.document).createTextRange(),f.collapse(!0));"Control"==b.docSelection.type?c(b):f&&"undefined"!=typeof f.text?
C(b,f):g(b)};else if(q.isHostMethod(z,"getRangeAt")&&"number"==typeof z.rangeCount)m=function(b){if(G&&H&&"Control"==b.docSelection.type)c(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var d=0,f=b.rangeCount;d<f;++d)b._ranges[d]=new a.WrappedRange(b.nativeSelection.getRangeAt(d));r(b,b._ranges[b.rangeCount-1],B(b.nativeSelection));b.isCollapsed=K(b)}else g(b)};else if(w&&"boolean"==typeof z.isCollapsed&&"boolean"==typeof R.collapsed&&a.features.implementsDomRange)m=
function(a){var b;b=a.nativeSelection;b.anchorNode?(b=O(b,0),a._ranges=[b],a.rangeCount=1,b=a.nativeSelection,a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset,a.isCollapsed=K(a)):g(a)};else return n.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;u.refresh=function(a){var b=a?this._ranges.slice(0):null;m(this);if(a){a=b.length;if(a!=this._ranges.length)return!1;for(;a--;)if(!F.rangesEqual(b[a],this._ranges[a]))return!1;
return!0}};var Q=function(a,b){var c=a.getAllRanges(),d=!1;a.removeAllRanges();for(var f=0,h=c.length;f<h;++f)d||b!==c[f]?a.addRange(c[f]):d=!0;a.rangeCount||g(a)};u.removeRange=G?function(a){if("Control"==this.docSelection.type){var b=this.docSelection.createRange();a=l(a);for(var f=d.getDocument(b.item(0)),f=d.getBody(f).createControlRange(),g,h=!1,k=0,p=b.length;k<p;++k)g=b.item(k),g!==a||h?f.add(b.item(k)):h=!0;f.select();c(this)}else Q(this,a)}:function(a){Q(this,a)};var B;!L&&w&&a.features.implementsDomRange?
(B=function(a){var b=!1;a.anchorNode&&(b=1==d.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset));return b},u.isBackwards=function(){return B(this)}):B=u.isBackwards=function(){return!1};u.toString=function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")};u.collapse=function(b,c){v(this,b);var f=a.createRange(d.getDocument(b));f.collapseToPoint(b,c);this.removeAllRanges();this.addRange(f);this.isCollapsed=!0};u.collapseToStart=function(){if(this.rangeCount){var a=
this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new A("INVALID_STATE_ERR");};u.collapseToEnd=function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new A("INVALID_STATE_ERR");};u.selectAllChildren=function(b){v(this,b);var c=a.createRange(d.getDocument(b));c.selectNodeContents(b);this.removeAllRanges();this.addRange(c)};u.deleteFromDocument=function(){if(G&&H&&"Control"==this.docSelection.type){for(var a=this.docSelection.createRange(),
b;a.length;)b=a.item(0),a.remove(b),b.parentNode.removeChild(b);this.refresh()}else if(this.rangeCount){a=this.getAllRanges();this.removeAllRanges();b=0;for(var c=a.length;b<c;++b)a[b].deleteContents();this.addRange(a[c-1])}};u.getAllRanges=function(){return this._ranges.slice(0)};u.setSingleRange=function(a){this.setRanges([a])};u.containsNode=function(a,b){for(var c=0,d=this._ranges.length;c<d;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1};u.toHtml=function(){var a="";if(this.rangeCount){for(var a=
F.getRangeDocument(this._ranges[0]).createElement("div"),b=0,c=this._ranges.length;b<c;++b)a.appendChild(this._ranges[b].cloneContents());a=a.innerHTML}return a};u.getName=function(){return"WrappedSelection"};u.inspect=function(){return k(this)};u.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};f.inspect=k;a.Selection=f;a.selectionPrototype=u;a.addCreateMissingNativeApiListener(function(b){"undefined"==typeof b.getSelection&&(b.getSelection=function(){return a.getSelection(this)});
b=null})});(function(a,n){function x(c,b){this.$element=a(c);a.ime.defaults.languages=l(a.ime.languages);this.options=a.extend({},a.ime.defaults,b);this.shifted=this.active=!1;this.language=this.inputmethod=null;this.context="";this.selector=this.$element.imeselector(this.options);this.listen()}function s(a){n.console&&n.console.log&&n.console.log(a)}function r(a){function b(a,c){var l,q;if(a.nodeType===Node.TEXT_NODE)k||a!==c.startContainer||(g=f+c.startOffset,k=!0),k&&a===c.endContainer&&(h=f+c.endOffset,
d=!0),f+=a.length;else for(q=a.childNodes.length,l=0;l<q&&(b(a.childNodes[l],c),!d);++l);}var f=0,g=0,h=0,k=!1,d=!1,l=rangy.getSelection();l.rangeCount&&b(a,l.getRangeAt(0));return[g,h]}function g(a,b){var f,g=0,l=0,k=a[0];h(k,b);for(f=r(k);b.start!==f[0];){--b.start;if(0>b.start)break;h(k,b);f=r(k);g+=1}for(;b.end!==f[1]&&!(b.end+=1,h(k,b),f=r(k),l+=1,10<l););return[g,l]}function h(a,b){function f(a){var c,n;if(3===a.nodeType)g=h+a.length,!d&&b.start>=h&&b.start<=g&&(k.setStart(a,b.start-h),d=!0),
d&&b.end>=h&&b.end<=g&&(k.setEnd(a,b.end-h),l=!0),h=g;else for(c=0,n=a.childNodes.length;c<n;++c)if(f(a.childNodes[c]),l){rangy.getSelection().setSingleRange(k);break}}var g,h=0,k=rangy.createRange(),d=!1,l=!1;k.collapseToPoint(a,0);f(a)}function l(c){return a.map(c,function(a,c){return c})}x.prototype={constructor:x,listen:function(){if(n.device&&"Android"==n.device.platform&&0<=versionCompare(n.device.version,"4.4")){var c=this;this.$element.on("keyup",function(b){var f=a(this).val(),g=f.slice(-1).charCodeAt(0);
65<=g&&122>=g&&(f=f.slice(0,f.length-1).replace(/[aeiou]/g,""),a(this).val(f),f=a.Event("keypress"),f.ctrlKey=!1,f.which=g,c.keypress(f),b.preventDefault())})}else this.$element.on("keypress.ime",a.proxy(this.keypress,this)),this.$element.on("keyup.ime",a.proxy(this.keyup,this)),this.$element.on("keydown.ime",a.proxy(this.keydown,this));this.$element.on("destroy.ime",a.proxy(this.destroy,this));this.$element.on("enable.ime",a.proxy(this.enable,this));this.$element.on("disable.ime",a.proxy(this.disable,
this))},transliterate:function(c,b,f){var g,h,k,d;f=f?this.inputmethod.patterns_x||[]:this.inputmethod.patterns||[];this.shifted&&(f=(this.inputmethod.patterns_shift||[]).concat(f));if(a.isFunction(f))return b=f.call(this,c,b),"string"===typeof b?{noop:c===b,output:b}:b;for(d=0;d<f.length;d++)if(h=f[d],g=new RegExp(h[0]+"$"),k=h.slice(-1)[0],g.test(c))if(3===h.length){if((new RegExp(h[1]+"$")).test(b))return{noop:!1,output:c.replace(g,k)}}else return{noop:!1,output:c.replace(g,k)};return{noop:!0,
output:c}},keyup:function(a){16===a.which&&(this.shifted=!1)},keydown:function(a){16===a.which&&(this.shifted=!0)},keypress:function(a){var b=!1,f,h,l,k,d;if(!this.active||!this.inputmethod)return!0;if(8===a.which)return this.context="",!0;if(a.altKey||a.altGraphKey)b=!0;if(32>a.which&&13!==a.which&&!b||a.ctrlKey||a.metaKey)return this.context="",!0;f=String.fromCharCode(a.which);l=this.getCaretPosition(this.$element);h=l[0];l=l[1];k=this.lastNChars(this.$element.val()||this.$element.text(),h,this.inputmethod.maxKeyLength);
k+=f;d=this.transliterate(k,this.context,b);this.context+=f;this.context.length>this.inputmethod.contextLength&&(this.context=this.context.substring(this.context.length-this.inputmethod.contextLength));if(d.noop)return!0;f=this.firstDivergence(k,d.output);k=k.substring(f);d.output=d.output.substring(f);b=this.$element;f=d.output;h=h-k.length+1;d=b.get(0);b.is("[contenteditable]")?(d=g(b,{start:h,end:l}),k=rangy.getSelection(),l=k.getRangeAt(0),0<d[0]&&(f=k.toString().substring(0,d[0])+f),k=document.createTextNode(f),
l.deleteContents(),l.insertNode(k),l.commonAncestorContainer.normalize(),h=l=h+f.length-d[0],g(b,{start:h,end:l})):"number"===typeof d.selectionStart&&"number"===typeof d.selectionEnd?(b=d.scrollTop,d.value=d.value.substring(0,h)+f+d.value.substring(l,d.value.length),d.scrollTop=b,d.selectionStart=d.selectionEnd=h+f.length):("input"===d.nodeName.toLowerCase()?b=d.createTextRange():(b=document.body.createTextRange(),b.moveToElementText(d)),k=b,b=d.value.length,(d=d.value.match(/\n/g))&&(b-=d.length),
k.moveStart("character",h),k.moveEnd("character",l-b),k.text=f,k.collapse(!1),k.select());a.stopPropagation();return!1},isActive:function(){return this.active},disable:function(){this.active=!1;a.ime.preferences.setIM("system")},enable:function(){this.active=!0},toggle:function(){this.active=!this.active},destroy:function(){a("body").off(".ime");this.$element.off(".ime").removeData("ime").removeData("imeselector")},getIM:function(){return this.inputmethod},setIM:function(c){this.inputmethod=a.ime.inputmethods[c];
a.ime.preferences.setIM(c)},setLanguage:function(c){if(!a.ime.languages[c])return s("Language "+c+" is not known to jquery.ime."),!1;this.language=c;a.ime.preferences.setLanguage(c);return!0},getLanguage:function(){return this.language},load:function(c){var b=this,f=a.Deferred(),g;if(a.ime.inputmethods[c])return f.resolve();if(!a.ime.sources[c])return f.reject();if((g=a.ime.sources[c].depends)&&!a.ime.inputmethods[g])return b.load(g).done(function(){b.load(c).done(function(){f.resolve()})}),f;s("Loading "+
c);f=a.ajax({url:b.options.imePath+a.ime.sources[c].source,dataType:"script",cache:!0}).done(function(){s(c+" loaded")}).fail(function(a,b,d){s("Error in loading inputmethod "+c+" Exception: "+d)});return f.promise()},getCaretPosition:function(a){var b;var f=a.get(0),g=0;b=0;var h,k;a.is("[contenteditable]")?b=r(f):("number"===typeof f.selectionStart&&"number"===typeof f.selectionEnd?(g=f.selectionStart,b=f.selectionEnd):(h=document.selection.createRange())&&h.parentElement()===f&&(a=f.value.length,
g=f.value.replace(/\r\n/g,"\n"),g=g.match(/\n/g),k=f.createTextRange(),k.moveToBookmark(h.getBookmark()),f=f.createTextRange(),f.collapse(!1),-1<k.compareEndPoints("StartToEnd",f)?g=g?b=a-g.length:b=a:(g=-k.moveStart("character",-a),b=-1<k.compareEndPoints("EndToEnd",f)?a:-k.moveEnd("character",-a))),b=[g,b]);return b},setCaretPosition:function(a,b){return g(a,b)},firstDivergence:function(a,b){var f;a:{var g;f=a.length<b.length?a.length:b.length;for(g=0;g<f;g++)if(a.charCodeAt(g)!==b.charCodeAt(g)){f=
g;break a}f=-1}return f},lastNChars:function(a,b,f){a=0===f?"":b<=f?a.substr(0,b):a.substr(b-f,f);return a}};a.fn.ime=function(c){return this.each(function(){var b,f=a(this),g="object"===typeof c&&c;if(!(f.prop("readonly")||f.prop("disabled")||f.hasClass("noime"))&&(b=f.data("ime"),b||(b=new x(this,g),f.data("ime",b)),"string"===typeof c))b[c]()})};a.ime={};a.ime.inputmethods={};a.ime.sources={};a.ime.preferences={};a.ime.languages={};var C={contextLength:0,maxKeyLength:1};a.ime.register=function(c){a.ime.inputmethods[c.id]=
a.extend({},C,c)};a.ime.defaults={imePath:"../",languages:[],helpHandler:null}})(jQuery,window);(function(a){function n(g,h){this.$element=a(g);this.options=a.extend({},n.defaults,h);this.active=!1;this.timer=this.inputmethod=this.$menu=this.$imeSetting=null;this.init();this.listen()}function x(){var a=document.createElement("p"),h=!1;if(a.addEventListener)a.addEventListener("DOMAttrModified",function(){h=!0},!1);else if(a.attachEvent)a.attachEvent("onDOMAttrModified",function(){h=!0});else return!1;a.setAttribute("id","target");return h}var s,r;n.prototype={constructor:n,init:function(){this.prepareSelectorMenu();
this.position();this.$imeSetting.hide()},prepareSelectorMenu:function(){this.$imeSetting=a(s);this.$menu=a('<div class="imeselector-menu" role="menu">');this.$menu.append(a("<h3>").addClass("ime-list-title autonym"),a("<ul>").addClass("ime-list"),!1,!1);this.prepareLanguageList();this.$menu.append(this.helpLink());a.i18n&&this.$menu.i18n();this.$imeSetting.append(this.$menu);a("body").append(this.$imeSetting)},stopTimer:function(){this.timer&&(clearTimeout(this.timer),this.timer=null);this.$imeSetting.stop(!0,
!0)},resetTimer:function(){var a=this;this.stopTimer();this.timer=setTimeout(function(){a.$imeSetting.animate({opacity:0,marginTop:"-20px"},500,function(){a.$imeSetting.hide()})},this.options.timeout)},focus:function(){a("div.imeselector").hide();a("div.imeselector-menu").removeClass("ime-open");this.$imeSetting.show();this.resetTimer()},show:function(){this.$menu.addClass("ime-open");this.stopTimer();this.$imeSetting.show();return!1},hide:function(){this.$menu.removeClass("ime-open");this.resetTimer();
return!1},toggle:function(){this.$menu.hasClass("ime-open")?this.hide():this.show()},listen:function(){var g=this;g.$imeSetting.on("click.ime",function(h){a(h.target).hasClass("imeselector-toggle")&&g.toggle();return!1});g.$element.on("blur.ime",function(){g.$imeSetting.hasClass("ime-onfocus")||(g.$imeSetting.hide(),g.hide())});a("html").click(function(){g.hide()});this.$menu.on("click",function(a){a.stopPropagation()});g.$imeSetting.mouseenter(function(){g.stopTimer();g.$imeSetting.addClass("ime-onfocus")}).mouseleave(function(){g.resetTimer();
g.$imeSetting.removeClass("ime-onfocus")});g.$menu.on("click.ime","li",function(){g.$element.focus();return!1});g.$menu.on("click.ime","li.ime-im",function(){g.selectIM(a(this).data("ime-inputmethod"));g.$element.trigger("setim.ime",a(this).data("ime-inputmethod"));return!1});g.$menu.on("click.ime","li.ime-lang",function(){var h=g.selectLanguage(a(this).attr("lang"));g.$element.trigger("setim.ime",h);return!1});g.$menu.on("click.ime","div.ime-disable",function(){g.disableIM();return!1});g.$menu.on("click.ime",
".ime-help-link",function(a){a.stopPropagation()});g.$element.on("focus.ime",function(a){g.selectLanguage(g.decideLanguage());g.focus();a.stopPropagation()});g.$element.attrchange(function(){g.$element.is(":hidden")&&g.$imeSetting.hide()});g.$element.on("mouseup.ime",a.proxy(this.position,this));g.$element.on("keydown.ime",a.proxy(this.keydown,this));a(window).resize(function(){g.position()})},keydown:function(g){var h=a(g.target).data("ime"),l;this.focus();return!g.ctrlKey||g.altKey||77!==g.which&&
13!==g.which?!0:(h.isActive()?(this.disableIM(),this.$element.trigger("setim.ime","system")):null!==this.inputmethod?(this.selectIM(this.inputmethod.id),this.$element.trigger("setim.ime",this.inputmethod.id)):(l=this.decideLanguage(),this.selectLanguage(l),!h.isActive()&&a.ime.languages[l]&&(h=a.ime.preferences.getPreviousInputMethods(),h[0]?this.selectIM(h[0]):(l=a.ime.languages[l].inputmethods[0],this.selectIM(l)))),g.preventDefault(),g.stopPropagation(),!1)},position:function(){var g,h,l,n,c,b=
this,f="rtl"===this.$element.css("direction");c=a(window);this.focus();h=this.$element.offset();l=h.top+this.$element.outerHeight();n=h.left;f||(n=h.left+this.$element.outerWidth()-this.$imeSetting.outerWidth());c.height()+a(document).scrollTop()-l<this.$imeSetting.outerHeight()&&(l=h.top-this.$imeSetting.outerHeight(),g=this.$menu.outerHeight()+this.$imeSetting.outerHeight(),g<l&&this.$menu.addClass("ime-position-top").css("top",-g));this.$element.parents().each(function(){if("fixed"===a(this).css("position"))return b.$imeSetting.css("position",
"fixed"),!1});this.$imeSetting.css({top:l,left:n});g=this.$menu.width();c=n+g>c.width();if(g>n||f&&c)f?c?(this.$menu.addClass("ime-right"),h=this.$imeSetting.outerWidth()-g):h=0:(this.$menu.addClass("ime-right"),h=h.left),this.$menu.css("left",h)},selectLanguage:function(g){var h,l,n;g=g&&g.toLowerCase();h=this.$element.data("ime");l=a.ime.preferences.getIM(g);n=a.ime.languages[g];this.setMenuTitle(this.getAutonym(g));if(!n)return!1;if(h.getLanguage()===g)return h.inputmethod&&h.inputmethod.id!==
l&&this.selectIM(a.ime.preferences.getIM(g)),a.ime.preferences.getIM(g);this.$menu.find("li.ime-lang").show();this.$menu.find("li[lang="+g+"]").hide();this.prepareInputMethods(g);this.hide();h.setLanguage(g);this.inputmethod=null;this.selectIM(a.ime.preferences.getIM(g));return a.ime.preferences.getIM(g)},getAutonym:function(g){return a.ime.languages[g]&&a.ime.languages[g].autonym},setMenuTitle:function(a){this.$menu.find(".ime-list-title").text(a)},decideLanguage:function(){return a.ime.preferences.getLanguage()?
a.ime.preferences.getLanguage():this.$element.attr("lang")&&a.ime.languages[this.$element.attr("lang")]?this.$element.attr("lang"):a.ime.preferences.getDefaultLanguage()},selectIM:function(g){var h=this,l;g&&(this.$menu.find(".ime-checked").removeClass("ime-checked"),this.$menu.find("li[data-ime-inputmethod="+g+"]").addClass("ime-checked"),l=this.$element.data("ime"),"system"===g?this.disableIM():l.load(g).done(function(){h.inputmethod=a.ime.inputmethods[g];h.hide();l.enable();l.setIM(g);h.$imeSetting.find("a.ime-name").text(a.ime.sources[g].name);
h.position();a.ime.preferences.save()}))},disableIM:function(){this.$menu.find(".ime-checked").removeClass("ime-checked");this.$menu.find("div.ime-disable").addClass("ime-checked");this.$element.data("ime").disable();this.$imeSetting.find("a.ime-name").text("");this.hide();this.position();a.ime.preferences.save()},prepareLanguageList:function(){var g,h,l,n,c,b;h=a('<div class="ime-language-list-wrapper">');l=a('<ul class="ime-language-list">');n=a.isFunction(this.options.languages)?this.options.languages():
this.options.languages;for(g in n)if(b=n[g],c=a.ime.languages[b])c=a("<a>").attr("href","#").text(this.getAutonym(b)).addClass("selectable-row-item autonym"),b=a('<li class="ime-lang selectable-row">').attr("lang",b),b.append(c),l.append(b);h.append(l);this.$menu.append(h);this.options.languageSelector&&this.$menu.append(this.options.languageSelector())},prepareInputMethods:function(g){g=a.ime.languages[g];var h=this.$menu.find(".ime-list"),l=this;h.empty();a.each(g.inputmethods,function(g,c){var b;
if(b=a.ime.sources[c])b=b.name,b=a("<a>").attr("href","#").text(b).addClass("selectable-row-item"),b=a("<li>").attr("data-ime-inputmethod",c).addClass("ime-im selectable-row").append('<span class="ime-im-check"></span>',b),l.options.helpHandler&&b.append(l.options.helpHandler.call(l,c)),h.append(b)})},helpLink:function(){return a('<div class="ime-help-link selectable-row">').append(a('<a id="ime-help-link" class="ime-udhavi">').text("உதவி").addClass("selectable-row-item").attr({href:"#"}))}};n.defaults=
{defaultLanguage:"en",timeout:0};a.fn.imeselector=function(g){return this.each(function(){var h=a(this),l=h.data("imeselector");l||h.data("imeselector",l=new n(this,g));"string"===typeof g&&l[g].call(h)})};a.fn.imeselector.Constructor=n;s='<div class="imeselector imeselector-toggle"><a class="ime-name imeselector-toggle" href="#"></a><b class="ime-setting-caret imeselector-toggle"></b></div>';r=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;a.fn.attrchange=function(a){if(r){var h;
h=new r(function(h){h.forEach(function(h){a.call(h.target,h.attributeName)})});return this.each(function(){h.observe(this,{subtree:!1,attributes:!0})})}if(x())return this.on("DOMAttrModified",function(h){a.call(this,h.attrName)});if("onpropertychange"in document.body)return this.on("propertychange",function(){a.call(this,window.event.propertyName)})}})(jQuery);(function(a){a.extend(a.ime.preferences,{registry:{isDirty:!1,language:null,previousLanguages:[],previousInputMethods:[],imes:{en:"system"}},setLanguage:function(n){n!==this.registry.language&&(this.registry.language=n,this.registry.isDirty=!0,this.registry.previousLanguages||(this.registry.previousLanguages=[]),-1===a.inArray(n,this.registry.previousLanguages)&&(this.registry.previousLanguages.unshift(n),this.registry.previousLanguages=this.registry.previousLanguages.slice(0,5)))},getLanguage:function(){return this.registry.language},
getDefaultLanguage:function(){return"en"},getPreviousLanguages:function(){return this.registry.previousLanguages},getPreviousInputMethods:function(){return this.registry.previousInputMethods},setIM:function(a){this.registry.imes||(this.registry.imes={});a!==this.registry.imes[this.registry.language]&&(this.registry.imes[this.getLanguage()]=a,this.registry.isDirty=!0,this.registry.previousInputMethods||(this.registry.previousInputMethods=[]),"system"!==a&&(this.registry.previousInputMethods.unshift(a),
this.registry.previousInputMethods=this.registry.previousInputMethods.slice(0,5)))},getIM:function(a){this.registry.imes||(this.registry.imes={});return this.registry.imes[a]||"system"},save:function(){},load:function(){}})})(jQuery);(function(a){a.extend(a.ime.sources,{"ta-transliteration":{name:"எழுத்துப்பெயர்ப்பு",source:"rules/ta/ta-transliteration.js"}});a.extend(a.ime.languages,{ta:{autonym:"தமிழ்",inputmethods:["ta-transliteration"]}})})(jQuery);(function(a){a.ime.register({id:"ta-transliteration",name:"எழுத்துப்பெயர்ப்பு",description:"Tamil Transliteration based input method",date:"2012-10-03",URL:"http://github.com/wikimedia/jquery.ime",author:"Junaid P V",license:"GPLv3",version:"1.0",contextLength:1,maxKeyLength:4,patterns:[["ச்h","h","ச்ஹ்"],["ழ்h","h","ழ்ஹ்"],["ஸ்ர்i","ஸ்ரீ"],["க்(ச்|ஸ்)h","க்‌ஷ்"],["க்(ச்|ஸ்)H","க்ஷ்"],["([க-ஹ])்a","$1"],["([க-ஹ])(்A|a)","$1ா"],["([க-ஹ])்i","$1ி"],["([க-ஹ])(்I|ிi)","$1ீ"],["([க-ஹ])்u","$1ு"],["([க-ஹ])(்U|ுu)",
"$1ூ"],["([க-ஹ])்e","$1ெ"],["([க-ஹ])(்E|ெe)","$1ே"],["([க-ஹ])i","$1ை"],["([க-ஹ])்o","$1ொ"],["([க-ஹ])(்O|ொo)","$1ோ"],["([க-ஹ])u","$1ௌ"],["([அ-ஹ][ெ-்]?)n","$1ன்"],["அa","ஆ"],["இi","ஈ"],["உu","ஊ"],["எe","ஏ"],["அi","ஐ"],["ஒo","ஓ"],["அu","ஔ"],["(ந்|ன்)g","ங்"],["(ந்|ன்)j","ஞ்"],["ச்h","ஷ்"],["ழ்h","ழ்"],["ட்h","த்"],["ஸ்h","ஷ்"],["a","அ"],["b","ப்"],["c","ச்"],["d","ட்"],["e","எ"],["f","ஃப்"],["g","க்"],["h","ஹ்"],["i","இ"],["j","ஜ்"],["k","க்"],["l","ல்"],["m","ம்"],["n","ன்"],["o","ஒ"],["p","ப்"],["q",
"ஃ"],["r","ர்"],["s","ச்"],["t","ட்"],["u","உ"],["v","வ்"],["w","ந்"],["y","ய்"],["z","ழ்"],["A","ஆ"],["B","ப்"],["C","க்க்"],["E","ஏ"],["F","ஃப்"],["G","க்"],["H","ஃ"],["I","ஈ"],["J","ஜ்ஜ்"],["K","க்"],["L","ள்"],["M","ம்ம்"],["N","ண்"],["O","ஓ"],["P","ப்ப்"],["Q","ஃ"],["R","ற்"],["S","ஸ்"],["T","ட்"],["U","ஊ"],["(V|W)","வ்வ்"],["Y","ய்ய்"],["Z","ஶ்"],["\\\\0","௦"],["\\\\1","௧"],["\\\\2","௨"],["\\\\3","௩"],["\\\\4","௪"],["\\\\5","௫"],["\\\\6","௬"],["\\\\7","௭"],["\\\\8","௮"],["\\\\9","௯"],["10\\\\",
"௰"],["100\\\\","௱"],["1000\\\\","௲"]]});a.ime.preferences.setLanguage("ta");a.ime.preferences.setIM("ta-transliteration")})(jQuery);